<html>
<head>
<script id="jquery-temp-id"></script>
<script>
var PATH = "http://" + document.location.host + "/apps/";
document.getElementById("jquery-temp-id").src = PATH + "app-loader/jquery-2.1.4.min.js";
document.getElementById("jquery-temp-id").id = "";
</script>

<link rel="stylesheet" type="text/css" href="https://fonts.googleapis.com/css?family=Open+Sans:300,400,600,700,800">
<link rel="stylesheet" type="text/css" href="https://fonts.googleapis.com/css?family=Source+Sans+Pro:200,300,400,600,700,900">
<link href="https://fonts.googleapis.com/icon?family=Material+Icons" rel="stylesheet">
<meta name="viewport" content="width=device-width, initial-scale=1">
</head>

<body>
<script>
var origin = "http://localhost:9000"
function receivedMessageFromSwipes(message){
	if(message.origin == origin){
		var i, json = JSON.parse(message.data);
		if(!json || !json.ok){
			console.log("error w/ json to app");
			return;
		}
		var data = json.data;
		if(data.identifier)
			swipes.path = PATH + data.identifier + "/"
		if(data.body){
			$('body').append(data.body);	
		}
		if(data.styles){
			for(i = 0 ; i < data.styles.length ; i++){
				var style = data.styles[i];
				$('body').append('<link rel="stylesheet" type="text/css" href="' + swipes.path + style + '">');
			}
		}
		if(data.scripts){
			for(i = 0 ; i < data.scripts.length ; i++){
				var script = data.scripts[i];
				$('body').append('<script src="' + swipes.path + script + '"><\/script>')
			}
		}
	}
}
window.addEventListener("message", receivedMessageFromSwipes, false);


var SwipesController = (function() {
	function SwipesController() {
		
	}
	SwipesController.prototype.test = function() {
		parent.postMessage(JSON.stringify({ok:true, type:"ping"}), origin);
	};

	return SwipesController;

})();
(function(){
	$(document).click(function(e){
		console.log("parent click", e);
	});
})
window.swipes = new SwipesController();
swipes.test();
</script>






<script type='text/javascript'>
/*
// This code is for hijacking and controlling ajax calls.
var s_ajaxListener = new Object();
s_ajaxListener.tempOpen = XMLHttpRequest.prototype.open;
s_ajaxListener.tempSend = XMLHttpRequest.prototype.send;
s_ajaxListener.callback = function () {
  // this.method :the ajax method used
  // this.url    :the url of the requested script (including query string, if any) (urlencoded) 
  // this.data   :the data sent, if any ex: foo=bar&a=b (urlencoded)
}

XMLHttpRequest.prototype.open = function(a,b) {
  if (!a) var a='';
  if (!b) var b='';
  s_ajaxListener.tempOpen.apply(this, arguments);
  s_ajaxListener.method = a;  
  s_ajaxListener.url = b;
  if (a.toLowerCase() == 'get') {
    s_ajaxListener.data = b.split('?');
    s_ajaxListener.data = s_ajaxListener.data[1];
  }
}

XMLHttpRequest.prototype.send = function(a,b) {
  if (!a) var a='';
  if (!b) var b='';
  s_ajaxListener.tempSend.apply(this, arguments);
  if(s_ajaxListener.method.toLowerCase() == 'post')s_ajaxListener.data = a;
  s_ajaxListener.callback();
}*/
</script>
</body>
</html>